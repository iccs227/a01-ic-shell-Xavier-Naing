/* ICCS227: Project 1: icsh
 * Name: Min Thu Ta Naing
 * StudentID: 6680713
 */

#include "stdio.h"
#include <string.h>
#include <stdlib.h>
#include <sys/wait.h>

#define MAX_CMD_BUFFER 255

int main() {
    char buffer[MAX_CMD_BUFFER];
    char last_command[MAX_CMD_BUFFER]="";
    int exit_code;
    printf("Starting IC shell\nicsh $ <waiting for command>\n");
    while (1) {
        printf("icsh $ ");
        fgets(buffer, 255, stdin);
        buffer[strcspn(buffer, "\n")] = '\0';
        if (strcmp(buffer,"!!") == 0){
            if(strlen(last_command) == 0){
                printf("No previous command found!\n");
                continue;
            }
            else{
                printf("%s\n", last_command);
                strcpy(buffer,last_command);
            }
        }  
        strcpy(last_command, buffer);
        if(strncmp(buffer,"echo",4) == 0){
            char* temp = buffer + 5;
            printf("%s\n",temp);
        }
        else if(strncmp(buffer,"exit",4)==0){
            char *temp = buffer + 4;
            exit_code = atoi(temp);
            exit_code &= 0xFF;
            printf("bye\n");
            exit(exit_code);
        }
        else{
            printf("Unknown command.\n");
        }
    }
}
